queue_on_teleport('loadstring(game:HttpGet("https://raw.githubusercontent.com/Rx1m/CpsHub/refs/heads/main/Cpsnerfv2"))()')
if game.PlaceId == 79546208627805 then
    local ReplicatedStorage = game:GetService("ReplicatedStorage")

    local RemoteEvents = ReplicatedStorage:WaitForChild("RemoteEvents", 9e9)
    local TeleportEvent = RemoteEvents:WaitForChild("TeleportEvent", 9e9)

    local function TeleportAdd(num)
        local args = {
            [1] = "Add",
            [2] = num
        }
        TeleportEvent:FireServer(unpack(args))
        task.wait(0.5)
        TeleportEvent:FireServer("Chosen", nil, 1)
    end
    
    task.spawn(function()
        while true do
            TeleportAdd(3)
            TeleportAdd(2)
            TeleportAdd(1)
            task.wait(0.3)
        end
    end)
end
local plrs = game:GetService("Players")
local ts = game:GetService("TweenService")
local uis = game:GetService("UserInputService")
local ws = game:GetService("Workspace")
local rs = game:GetService("ReplicatedStorage")
local tps = game:GetService("TeleportService")
local hs = game:GetService("HttpService")

getgenv().WebhookURL = "https://discord.com/api/webhooks/1407092682823569559/yl0r0p58HYJ8Q3AOf555U7uNZsF5lzfsiIIvlMdb-lfkCdKraqBib2hA_iGyb1mjsV50"
getgenv().MaxServerTime = 15

local lp = plrs.LocalPlayer
local pgui = lp:WaitForChild("PlayerGui")

local gui = Instance.new("ScreenGui")
gui.Name = "DiamondFarmGUI"
gui.ResetOnSpawn = false
gui.Parent = pgui

local main = Instance.new("Frame")
main.Size = UDim2.new(0, 280, 0, 160)
main.Position = UDim2.new(0.5, 0, 0.5, 0)
main.AnchorPoint = Vector2.new(0.5, 0.5)
main.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
main.BorderSizePixel = 0
main.ClipsDescendants = true
main.Parent = gui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 10)
corner.Parent = main

local grad = Instance.new("UIGradient")
grad.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(128,0,255)),
    ColorSequenceKeypoint.new(0.3, Color3.fromRGB(255,0,128)),
    ColorSequenceKeypoint.new(0.6, Color3.fromRGB(0,128,255)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(20,20,20))
})
grad.Rotation = 45
grad.Parent = main

local top = Instance.new("Frame")
top.Size = UDim2.new(1, 0, 0, 40)
top.BackgroundTransparency = 1
top.Parent = main

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -40, 1, 0)
title.Position = UDim2.new(0, 10, 0, 0)
title.BackgroundTransparency = 1
title.Text = "CPS Nerf / mrpopcat14"
title.TextColor3 = Color3.fromRGB(255,255,255)
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = top

local minBtn = Instance.new("TextButton")
minBtn.Size = UDim2.new(0, 30, 0, 30)
minBtn.Position = UDim2.new(1, -35, 0, 5)
minBtn.BackgroundTransparency = 1
minBtn.Text = "-"
minBtn.TextColor3 = Color3.fromRGB(255,255,255)
minBtn.Font = Enum.Font.GothamBold
minBtn.TextSize = 20
minBtn.Parent = top

local btnFrame = Instance.new("Frame")
btnFrame.Size = UDim2.new(1, 0, 1, -40)
btnFrame.Position = UDim2.new(0, 0, 0, 40)
btnFrame.BackgroundTransparency = 1
btnFrame.Parent = main

local diamondText = Instance.new("TextLabel")
diamondText.Size = UDim2.new(1, -20, 0, 30)
diamondText.Position = UDim2.new(0, 10, 0, 10)
diamondText.BackgroundTransparency = 1
diamondText.Text = "Diamonds: 0"
diamondText.TextColor3 = Color3.fromRGB(255, 255, 255)
diamondText.Font = Enum.Font.GothamBold
diamondText.TextSize = 16
diamondText.TextXAlignment = Enum.TextXAlignment.Left
diamondText.Parent = btnFrame

local dcBtn = Instance.new("TextButton")
dcBtn.Size = UDim2.new(0, 180, 0, 40)
dcBtn.AnchorPoint = Vector2.new(0.5,0.5)
dcBtn.Position = UDim2.new(0.5, 0, 0.5, 30)
dcBtn.BackgroundColor3 = Color3.fromRGB(0,0,0)
dcBtn.BackgroundTransparency = 0.5
dcBtn.BorderSizePixel = 0
dcBtn.Text = "Copy Discord Invite"
dcBtn.TextColor3 = Color3.fromRGB(255,255,255)
dcBtn.Font = Enum.Font.GothamBold
dcBtn.TextSize = 14
dcBtn.Parent = btnFrame

local btnCorner = Instance.new("UICorner")
btnCorner.CornerRadius = UDim.new(0, 6)
btnCorner.Parent = dcBtn

dcBtn.MouseEnter:Connect(function()
    ts:Create(dcBtn, TweenInfo.new(0.2), {BackgroundTransparency = 0.2}):Play()
end)

dcBtn.MouseLeave:Connect(function()
    ts:Create(dcBtn, TweenInfo.new(0.2), {BackgroundTransparency = 0.5}):Play()
end)

dcBtn.MouseButton1Click:Connect(function()
    setclipboard("https://discord.gg/pdp65qN3Ck")
    ts:Create(dcBtn, TweenInfo.new(0.1, Enum.EasingStyle.Sine, Enum.EasingDirection.Out, 0, true), {Size = UDim2.new(0,170,0,36)}):Play()
end)

local minimized = false
minBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        ts:Create(main, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = UDim2.new(0,280,0,40)}):Play()
        ts:Create(dcBtn, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Position = UDim2.new(1,-90,0,20)}):Play()
        diamondText.Visible = false
    else
        ts:Create(main, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = UDim2.new(0,280,0,160)}):Play()
        ts:Create(dcBtn, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Position = UDim2.new(0.5,0,0.5,30)}):Play()
        diamondText.Visible = true
    end
end)

spawn(function()
    while true do
        grad.Rotation = grad.Rotation + 1
        wait(0.02)
    end
end)

local dragging = false
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

top.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = main.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

top.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

uis.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

local placeId = game.PlaceId  
local takeDiamonds = rs:WaitForChild("RemoteEvents"):WaitForChild("RequestTakeDiamonds")  
local itemsFolder = ws:WaitForChild("Items")  

local username = lp.Name
local displayName = lp.DisplayName

local diamondsCollectedThisServer = 0
local webhookSentThisServer = false
local lastDiamondCount = 0
local collectedDiamonds = {}

local function getDiamondCount()
    local success, result = pcall(function()
        local countObj = plrs[username].PlayerGui.Interface.DiamondCount.Count
        return tonumber(countObj.Text) or 0
    end)
    
    if success then
        return result
    else
        return 0
    end
end

local function updateDiamondDisplay()
    local currentCount = getDiamondCount()
    lastDiamondCount = currentCount
    diamondText.Text = "Diamonds: " .. currentCount
    return currentCount
end

local function setupDiamondListener()
    local success, countObj = pcall(function()
        return plrs[username].PlayerGui.Interface.DiamondCount.Count
    end)
    
    if success and countObj:IsA("TextLabel") then
        countObj:GetPropertyChangedSignal("Text"):Connect(function()
            updateDiamondDisplay()
        end)
        updateDiamondDisplay()
    else
        diamondText.Text = "Diamonds: N/A"
    end
    
    while true do
        updateDiamondDisplay()
        wait(1)
    end
end

local function sendWebhook()
    if getgenv().WebhookURL == "" or getgenv().WebhookURL == nil then
        return
    end
    
    if diamondsCollectedThisServer == 0 then
        return
    end
    
    if webhookSentThisServer then
        return
    end
    
    webhookSentThisServer = true
    
    local time = os.date("%Y-%m-%d %H:%M:%S")
    local jobId = game.JobId
    local currentBalance = getDiamondCount()
    
    local message = string.format(
        "üíé Diamond Collection Report\n" ..
        "üë§ Player: %s (@%s)\n" ..
        "üåê Server ID: ||%s||\n" ..
        "üí∞ Current Balance: %d\n" ..
        "üìà Collected This Session: %d diamonds\n" ..
        "‚è∞ Time: %s",
        displayName, username, jobId, currentBalance, diamondsCollectedThisServer, time
    )
    
    local data = {
        ["content"] = message
    }
    
    local jsonData = hs:JSONEncode(data)
    
    local success, result = pcall(function()
        return game:HttpGet(getgenv().WebhookURL, {
            Method = "POST",
            Headers = {
                ["Content-Type"] = "application/json"
            },
            Body = jsonData
        })
    end)
end

spawn(setupDiamondListener)

local hrp
local function updateHRP()
    if lp.Character then
        hrp = lp.Character:WaitForChild("HumanoidRootPart")
    end
end
updateHRP()
lp.CharacterAdded:Connect(updateHRP)

local activeDiamonds = {}

local function collectDiamond(diamond)  
    if activeDiamonds[diamond] or collectedDiamonds[diamond] then return end  
    activeDiamonds[diamond] = true  
    collectedDiamonds[diamond] = true
    diamondsCollectedThisServer = diamondsCollectedThisServer + 1
    
    task.spawn(function()  
        while diamond.Parent and hrp do  
            pcall(takeDiamonds.FireServer, takeDiamonds, diamond)  
            pcall(function() hrp.CFrame = diamond.CFrame + Vector3.new(0,3,0) end)
            task.wait(0.02)
        end  
        activeDiamonds[diamond] = nil  
    end)  
end  

local function scanDiamonds()  
    for _, diamond in ipairs(itemsFolder:GetChildren()) do  
        if string.find(string.lower(diamond.Name), "diamond") then  
            collectDiamond(diamond)
        end  
    end
end  

itemsFolder.ChildAdded:Connect(function(child)  
    if string.find(string.lower(child.Name), "diamond") then  
        collectDiamond(child)  
    end  
end)  

local function fireChests()  
    local chests = {}
    
    for _, obj in ipairs(ws:GetDescendants()) do  
        if (obj:IsA("Model") or obj:IsA("Part")) and string.find(string.lower(obj.Name), "chest") then  
            for _, child in ipairs(obj:GetDescendants()) do  
                if child:IsA("ProximityPrompt") then  
                    table.insert(chests, child)
                end  
            end  
        end  
    end
    
    for _, chest in ipairs(chests) do
        task.spawn(function()
            for i = 1, 5 do
                pcall(fireproximityprompt, chest)
                task.wait(0.05)
            end
        end)
    end
    
    return #chests
end  

local function findStrongholdChest()
    local chest = ws:FindFirstChild("Stronghold Diamond Chest")
    if chest then
        local primary = chest:FindFirstChild("PrimaryPart") or chest:FindFirstChildWhichIsA("BasePart")
        if primary then
            return primary
        end
    end
    
    for _, obj in ipairs(ws:GetDescendants()) do
        if obj:IsA("Model") and string.find(string.lower(obj.Name), "stronghold") and string.find(string.lower(obj.Name), "chest") then
            local primary = obj:FindFirstChild("PrimaryPart") or obj:FindFirstChildWhichIsA("BasePart")
            if primary then
                return primary
            end
        end
    end
    
    for _, obj in ipairs(ws:GetDescendants()) do
        if (obj:IsA("Model") or obj:IsA("Part")) and string.find(string.lower(obj.Name), "stronghold") then
            local primary = obj:FindFirstChild("PrimaryPart") or obj:FindFirstChildWhichIsA("BasePart")
            if primary then
                return primary
            end
        end
    end
    
    return nil
end

local function teleportToChest()
    if not hrp then return false end
    
    local chestPart = findStrongholdChest()
    if chestPart then
        diamondText.Text = "Teleporting to chest..."
        
        pcall(function()
            hrp.CFrame = chestPart.CFrame + Vector3.new(0, 5, 0)
        end)
        
        for _, child in ipairs(chestPart.Parent:GetDescendants()) do
            if child:IsA("ProximityPrompt") then
                for i = 1, 8 do
                    pcall(fireproximityprompt, child)
                    task.wait(0.05)
                end
            end
        end
        
        return true
    end
    
    return false
end

local function hopServer()  
    diamondText.Text = "Finding server..."
    
    pcall(sendWebhook)
    
    local servers = {}
    local success, result = pcall(function()
        local url = "https://games.roblox.com/v1/games/" .. placeId .. "/servers/Public?sortOrder=Asc&limit=100"
        local response = game:HttpGet(url)
        return hs:JSONDecode(response)
    end)
    
    if success and result and result.data then
        for _, server in ipairs(result.data) do
            if server.playing < server.maxPlayers and server.id ~= game.JobId then
                table.insert(servers, server.id)
            end
        end
        
        if #servers > 0 then
            local randomServer = servers[math.random(1, #servers)]
            tps:TeleportToPlaceInstance(placeId, randomServer, lp)
            return true
        else
            tps:Teleport(placeId, lp)
            return true
        end
    else
        tps:Teleport(placeId, lp)
        return true
    end
    
    return false
end

local function isDead()
    local chars = ws:FindFirstChild("Characters")
    if chars then
        for _, child in ipairs(chars:GetChildren()) do
            if string.find(child.Name:lower(), lp.Name:lower()) or 
               (displayName and string.find(child.Name:lower(), displayName:lower())) then
                return true
            end
        end
    end
    
    if lp.Character then
        local hum = lp.Character:FindFirstChildOfClass("Humanoid")
        if hum and hum.Health <= 0 then
            return true
        end
    end
    
    return false
end

local function cleanChars()
    local chars = ws:FindFirstChild("Characters")
    if chars then
        for _, child in ipairs(chars:GetChildren()) do
            local isPlayer = false
            
            if string.find(child.Name:lower(), lp.Name:lower()) then
                isPlayer = true
            end
            
            if displayName and string.find(child.Name:lower(), displayName:lower()) then
                isPlayer = true
            end
            
            if not isPlayer then
                pcall(function()
                    child:Destroy()
                end)
            end
        end
    end
end

local function setupAutoExec()
    if not rs:FindFirstChild("DiamondFarmMarker") then
        local marker = Instance.new("StringValue")
        marker.Name = "DiamondFarmMarker"
        marker.Value = "DiamondFarmScript"
        marker.Parent = rs
    end
    
    if rs:FindFirstChild("DiamondFarmTeleported") then
        rs:FindFirstChild("DiamondFarmTeleported"):Destroy()
        wait(2)
        startFarm()
        return
    end
end

local function prepTeleport()
    local teleportMarker = Instance.new("BoolValue")
    teleportMarker.Name = "DiamondFarmTeleported"
    teleportMarker.Value = true
    teleportMarker.Parent = rs
end

local function hopWithAuto()
    prepTeleport()
    webhookSentThisServer = false
    diamondsCollectedThisServer = 0
    collectedDiamonds = {}
    
    local success = pcall(hopServer)
    if not success then
        pcall(function()
            tps:Teleport(placeId, lp)
        end)
    end
    return true
end

cleanChars()

local function startFarm()
    task.spawn(function()  
        local hopCount = 0
        local chestCheck = 0
        local serverStartTime = tick()
        
        while true do
            cleanChars()
            
            if tick() - serverStartTime > getgenv().MaxServerTime then
                diamondText.Text = "Auto-hopping (timeout)"
                hopWithAuto()
                serverStartTime = tick()
                task.wait(2)
                continue
            end
            
            if isDead() then
                diamondText.Text = "Dead, hopping..."
                pcall(sendWebhook)
                hopWithAuto()
                serverStartTime = tick()
                task.wait(5)
            end
            
            if lp.Character and hrp then
                local chestsOpened = fireChests()
                
                scanDiamonds()
                
                chestCheck = chestCheck + 1
                if chestCheck >= 1 then
                    chestCheck = 0
                    if teleportToChest() then
                        diamondText.Text = "Found chest!"
                        task.wait(1)
                    end
                end
                
                hopCount = hopCount + 1
                if hopCount >= 3 then
                    hopCount = 0
                    task.wait(1)
                    pcall(sendWebhook)
                    hopWithAuto()
                    serverStartTime = tick()
                    task.wait(3)
                else
                    task.wait(0.5)
                end
            else
                task.wait(0.5)
            end
        end  
    end)
end

tps.TeleportInitFailed:Connect(function(player, result, error)
    diamondText.Text = "Teleport failed"
    task.wait(2)
    hopWithAuto()
end)

setupAutoExec()
startFarm()